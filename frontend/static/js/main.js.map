{"version":3,"sources":["login.js","register.js","search.js","upload.js","main.js"],"names":["login","e","preventDefault","data","username","$","val","password","ajax","type","url","done","status","jqXHR","window","location","href","fail","errorMessage","JSON","parse","responseText","error","html","register","confirm_password","email","search","addClass","input","query","results","show","showResults","hide","removeClass","empty","i","length","append","name","originalName","getLabels","image","j","labels","push","tag","material_chip","placeholder","on","chip","photo","dataset","label","changeName","titleElement","titleInput","document","createElement","className","innerHTML","addEventListener","newTitle","parentNode","replaceChild","focus","upload","form","formData","FormData","cache","contentType","processData","console","log","replaceWith","ready","getElementById","setTimeout"],"mappings":"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","file":"main.js","sourcesContent":["function login(e) {\n\te.preventDefault()\n\t// Retrieve form data and create object\n\tlet data = {\n\t\tusername: \t$('#username').val(),\n\t\tpassword: \t$('#password').val()\n\t}\n\t// Post data object to server\n\t$.ajax({\n\t\ttype: \t'POST',\n\t\turl: \t'/login',\n\t\tdata: \tdata\n\t}).done( (data, status, jqXHR) => {\n\t\twindow.location.href = '/upload.html'\n\t}).fail( jqXHR => {\n\t\t// Get error message from response object\n\t\tlet errorMessage = JSON.parse(jqXHR.responseText).error\n\t\t// Display error message to user\n\t\t$('.message').html('<p>' + errorMessage + '</p>')\n\t})\n}","function register(e) {\n\t// TODO: front end validation!\n\t// Disabled the standard button properties\n\te.preventDefault()\n\t// Retrieve form data and create data object\n\tlet data = {\n\t\tusername: \t\t\t$('#username').val(),\n\t\tpassword: \t\t\t$('#password').val(),\n\t\tconfirm_password: \t$('#confirm_password').val(),\n\t\temail: \t\t\t\t$('#email').val()\t\n\t}\n\t// Post data object to server\n\t$.ajax({\n\t\ttype: \t'POST',\n\t\turl: \t'/register',\n\t\tdata: \tdata\n\t}).done( (data, status, jqXHR) => {\n\t\t// data = user object; status = 'success'; jqXHR = entire response object\n\t\t// Redirect user to next page\n\t\twindow.location.href = '/index.html'\n\t}).fail( jqXHR => {\n\t\t// Get error message from response object\n\t\tlet errorMessage = JSON.parse(jqXHR.responseText).error\n\t\t// Display error message to user\n\t\t$('.message').html('<p>' + errorMessage + '</p>')\n\t})\n}","function search(e) {\n\te.preventDefault()\n\n\tif ($('#search-input').val() !== \"\") {\n\t\t$('#searchbar').addClass('search-active')\n\t\t// Create data model for query\n\t\tlet input = { query: $('#search-input').val() }\n\t\t// Send ajax request to search database\n\t\t$.ajax({\n\t\t\ttype: \t'POST',\n\t\t\turl: \t'/search',\n\t\t\tdata: \tinput\n\t\t}).done( results => {\n\t\t\tif (results) {\n\t\t\t\t// Clear old results\n\t\t\t\t$('#columns').show()\n\t\t\t\tshowResults(results)\n\t\t\t} else {\n\t\t\t\twindow.location.href = '/login.html'\n\t\t\t}\n\t\t})\n\t} else {\n\t\t$('#columns').hide()\n\t\t$('#searchbar').removeClass('search-active')\n\t}\n}\n\nfunction showResults(results) {\n\t$('#columns').empty()\n\tfor (var i = 0; i < results.length; i++) {\n\t\t$('#columns').append(`\n\t\t\t<div class=\"card-padding\">\n\t\t\t\t<div class=\"card\" data-id=\"` + i + `\" data-name=\"` + results[i].name + `\"> \n\t\t\t\t\t<div class=\"card-image\">\n\t\t\t\t\t\t<img src=\"/uploads/`+ results[i].name + `\">\n\t\t\t\t\t\t<span class=\"card-title\" onclick=\"changeName(this, '` + results[i].name +`', '` + results[i].originalName +`')\">` + results[i].originalName + `</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"card-content\">\n\t\t\t\t\t\t<div id=\"result` + i + `\" class=\"chips\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)\n\t\tgetLabels(results[i], i)\n\t}\n}\n\nfunction getLabels(image, i) {\n\tlet data = []\n\t// Get all labels and create tag objects\n\tfor (let j = 0; j < image.labels.length; j++) {\n\t\tdata.push({ tag: image.labels[j].name })\n\t}\n\t// Add the tag objects and placeholder to chips div\n\t$('#result'+i).material_chip({\n\t\tdata: data,\n\t\tplaceholder: 'Add a tag'\n\t})\n\t// Add event listener when chip is deleted\n\t$('#result'+i).on('chip.delete', function(e, chip){\n\t\t// Get the photo to which the tag is related\n\t\tlet photo = $('[data-id=\"' + i +'\"]')[0].dataset.name\n\t\t// Send request to server to delete tag\n\t\t$.ajax({\n\t\t\ttype: \t'POST',\n\t\t\turl: \t'/removelabel',\n\t\t\tdata: \t{ label: chip.tag, photo: photo }\n\t\t})\n  })\n\n\t// Ass event listener when chip is added\n  $('#result'+i).on('chip.add', function(e, chip){\n\t\t// Get photo to which the tag is related\n\t\tlet photo = $('[data-id=\"' + i + '\"]')[0].dataset.name\n\t\t// Send request to server to add tag\n\t\t$.ajax({\n\t\t\ttype: \t'POST',\n\t\t\turl: \t'/addlabel',\n\t\t\tdata: \t{ label: chip.tag, photo: photo }\n\t\t})\n  })\n}\n\nfunction changeName(titleElement, name, originalName) {\n\t// Create input element\n\tlet titleInput = document.createElement('span')\n\ttitleInput.className = 'card-title'\n\ttitleInput.innerHTML = `\n\t\t<form><input class=\"change-title\" type=\"text\" name=\"title\" placeholder=\"Enter new title\"><form>\n\t`\n\t// Add event listener for when new title is submitted\n\ttitleInput.addEventListener('submit', function(e) {\n\t\te.preventDefault()\n\t\t// get the new title\n\t\tlet newTitle = $('.change-title').val()\n\t\t// TODO: Any title validation?\n\n\t\t// Post new title to server to update in db\n\t\t$.ajax({\n\t\t\ttype: \t'POST',\n\t\t\turl: \t'/changetitle',\n\t\t\tdata: \t{ \t\n\t\t\t\t\t\tnewTitle: newTitle, \n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\toriginalName: originalName\n\t\t\t\t\t}\n\t\t})\n\t\t// After submit, turn input element back to regular title\n\t\ttitleElement.innerHTML = newTitle\n\t\ttitleInput.parentNode.replaceChild(titleElement, titleInput)\n\t})\n\t// Replace old title with new input element\n\ttitleElement.parentNode.replaceChild(titleInput, titleElement)\n\t// Set focus on newly added input element\n\t$('.change-title').focus()\n}\n","function upload(e) {\n\te.preventDefault()\n\n\tlet form = $('#formData')[0]\n\tlet formData = new FormData(form)\n\t// console.log(formData.get('files'))\n\n\t$.ajax({\n\t\ttype: \t\t\t'POST',\n\t\turl: \t\t\t'/upload',\n\t\tdata: \t\t\tformData,\n\t\tcache: \t\t\tfalse,\n\t\tcontentType: \tfalse,\n\t\tprocessData: \tfalse\n\t}).done ( data => {\n\t\tif (data) {\n\t\t\twindow.location.href = '/search.html'\n\t\t} else {\n\t\t\twindow.location.href = '/login.html'\n\t\t}\n\t}).fail( jqXHR => {\n\t\tconsole.log(jqXHR)\n\t})\n\n\t$('#loader').replaceWith(`\n\t\t<div class=\"preloader-wrapper big active center-block\">\n\t\t\t<div class=\"spinner-layer spinner-layer\">\n\t\t\t\t<div class=\"circle-clipper left\">\n\t\t\t\t\t<div class=\"circle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"gap-patch\">\n\t\t\t\t\t<div class=\"circle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"circle-clipper right\">\n\t\t\t\t\t<div class=\"circle\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`)\n}","$(document).ready( () => {\n\t\n\t// console.log(authenticate())\n\n\tif ( document.getElementById('login') ) $('#login').on('click', login)\n\n\tif ( document.getElementById('register') ) $('#register').on('click', register)\n\n\tif ( document.getElementById('upload') ) {\n\t\t$('#upload').on('click', upload)\n\t}\n\n\tif ( document.getElementById('search-input') ) {\n\t\t$('#search-input').on('input propertychange', search)\n\t}\n\tif ( document.getElementById('logout-message') ) {\n\t\tsetTimeout( () => {\n\t\t\twindow.location.href = '/'\n\t\t}, 3000)\n\t\t$.ajax({\n\t\t\ttype: \t'POST',\n\t\t\turl: \t'/logout'\n\t\t})\n\t}\n\n})\n\n// function checkLogin() {\n// \tconsole.log('checked login')\n// \tconsole.log(document.cookie)\n// \tif (document.cookie.indexOf('loggedIn') !== -1) {\n// \t\tconsole.log('true')\n// \t\treturn true\n// \t} else {\n// \t\tconsole.log('false')\n// \t\treturn false\n// \t}\n// }"]}